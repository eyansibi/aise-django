{% extends "frontoffice/base.html" %}
{% load static %}

{% block page_title %}Blog{% endblock %}

{% block content %}
<style>
    :root {
        --primary: #087065;
        --secondary: #F4CA23;
        --primary-dark: #065a52;
        --gray-50: #f8f9fa;
        --gray-100: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-700: #374151;
        --gray-900: #111827;
        --purple: #7c3aed;
        --purple-light: #e9d5ff;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-400: #9ca3af;
    }

    .blog-list { max-width: 1600px; margin: 0 auto; padding: 2rem 1rem; }
    .section-header { text-align: center; margin-bottom: 2.5rem; }
    .section-header h1 { font-size: 3.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.75rem; position: relative; display: inline-block; }
    .section-header h1::after { content: ''; position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%); width: 100px; height: 6px; background: var(--secondary); border-radius: 3px; }
    .section-header p { font-size: 1.3rem; color: var(--gray-700); max-width: 800px; margin: 0 auto; }

    .toolbar { background: white; border-radius: 2rem; padding: 1.5rem; margin-bottom: 2.5rem; box-shadow: 0 15px 35px rgba(0,0,0,0.08); border: 1px solid var(--gray-100); display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; justify-content: space-between; backdrop-filter: blur(10px); }

    .search-container { position: relative; flex: 1; min-width: 280px; }
    .search-input { width: 100%; padding: 1rem 1.25rem; padding-left: 3.5rem; padding-right: 4rem; border: 2px solid var(--gray-100); border-radius: 1.5rem; font-size: 1rem; background: var(--gray-50); transition: all 0.4s ease; font-weight: 500; }
    .search-input:focus { outline: none; border-color: var(--primary); background: white; box-shadow: 0 0 0 5px rgba(8, 112, 101, 0.12); transform: translateY(-2px); }
    .search-icon { position: absolute; left: 1.25rem; top: 50%; transform: translateY(-50%); width: 1.5rem; height: 1.5rem; color: var(--gray-500); transition: all 0.3s ease; }
    .search-input:focus ~ .search-icon { color: var(--primary); }
    .search-count { position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: var(--primary); color: white; font-size: 0.75rem; font-weight: 700; padding: 0.25rem 0.5rem; border-radius: 1rem; min-width: 2rem; text-align: center; opacity: 0; transition: all 0.3s ease; }
    .search-count.show { opacity: 1; }

    .filter-group { display: flex; gap: 1rem; flex-wrap: wrap; }
    .filter-select { padding: 0.75rem 1rem; border: 2px solid var(--gray-100); border-radius: 1.5rem; background: white; font-size: 1rem; min-width: 160px; cursor: pointer; transition: all 0.3s ease; font-weight: 500; }
    .filter-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(8, 112, 101, 0.1); }

    .view-buttons { display: flex; gap: 0.5rem; background: var(--gray-50); padding: 0.5rem; border-radius: 1.5rem; border: 2px solid var(--gray-100); }
    .view-btn { width: 44px; height: 44px; border-radius: 1rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; color: var(--gray-600); background: transparent; }
    .view-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(8, 112, 101, 0.3); }
    .view-btn:hover:not(.active) { background: var(--gray-100); color: var(--primary); }

    .blog-grid { display: grid; gap: 2rem; margin-bottom: 3rem; transition: all 0.4s ease; }
    .grid-1 { grid-template-columns: repeat(1, 1fr); }
    .grid-3 { grid-template-columns: repeat(1, 1fr); }
    .grid-6 { grid-template-columns: repeat(1, 1fr); }
    @media (min-width: 768px) { .grid-3 { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { .grid-3 { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 640px) { .grid-6 { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { .grid-6 { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 1536px) { .grid-6 { grid-template-columns: repeat(6, 1fr); } }

    .blog-card { background: white; border-radius: 2rem; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 1px solid var(--gray-100); transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); position: relative; height: 100%; display: flex; flex-direction: column; }
    .blog-card::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(124, 58, 237, 0.08) 0%, transparent 70%); opacity: 0; transition: opacity 0.5s ease; z-index: 0; border-radius: 2rem; }
    .blog-card:hover::before { opacity: 1; }
    .blog-card:hover { transform: translateY(-16px); box-shadow: 0 30px 60px rgba(124, 58, 237, 0.2); border-color: var(--purple); }

    .card-image { position: relative; overflow: hidden; height: 220px; }
    .card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.7s ease; }
    .blog-card:hover .card-image img { transform: scale(1.1); }
    .card-badge { position: absolute; top: 1rem; left: 1rem; background: var(--purple); color: white; font-size: 0.7rem; font-weight: 700; padding: 0.35rem 0.75rem; border-radius: 1rem; backdrop-filter: blur(8px); box-shadow: 0 4px 12px rgba(124,58,237,0.3); z-index: 2; text-transform: uppercase; letter-spacing: 0.5px; }
    .card-placeholder { width: 100%; height: 100%; background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%); display: flex; align-items: center; justify-content: center; }
    .card-placeholder svg { width: 70px; height: 70px; color: var(--purple); opacity: 0.7; }

    .card-body { padding: 2rem; flex-grow: 1; display: flex; flex-direction: column; position: relative; z-index: 1; }
    .card-title { font-size: 1.6rem; font-weight: 800; color: var(--gray-900); margin-bottom: 1rem; line-height: 1.3; transition: color 0.3s ease; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .blog-card:hover .card-title { color: var(--purple); }
    .card-excerpt { color: var(--gray-700); font-size: 1.05rem; line-height: 1.65; margin-bottom: 1.25rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; flex-grow: 1; }
    .card-footer { display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; color: var(--gray-600); margin-top: auto; }
    .card-date svg { width: 1.1rem; height: 1.1rem; margin-right: 0.5rem; color: var(--secondary); }
    .card-arrow { width: 2.5rem; height: 2.5rem; background: var(--purple); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; transform: scale(0.8); transition: all 0.4s ease; }
    .blog-card:hover .card-arrow { opacity: 1; transform: scale(1); }
    .card-arrow svg { width: 1.4rem; height: 1.4rem; }

    .pagination-container { display: flex; justify-content: center; align-items: center; gap: 0.75rem; margin-top: 3rem; }
    .pagination-btn { min-width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: all 0.3s ease; border: 2px solid var(--gray-100); background: white; color: var(--gray-700); padding: 0 0.75rem; }
    .pagination-btn:hover:not(.disabled) { background: var(--purple); color: white; border-color: var(--purple); transform: translateY(-3px); box-shadow: 0 10px 25px rgba(124, 58, 237, 0.25); }
    .pagination-btn.active { background: var(--purple); color: white; border-color: var(--purple); font-weight: 700; }

    .empty-state { grid-column: 1 / -1; text-align: center; padding: 5rem 2rem; background: var(--gray-50); border-radius: 2rem; border: 2px dashed var(--gray-300); }
    .empty-state svg { width: 90px; height: 90px; margin-bottom: 1.5rem; color: var(--gray-400); }

    @media (max-width: 640px) {
        .toolbar { flex-direction: column; align-items: stretch; }
        .search-container, .filter-group, .view-buttons { min-width: 100%; }
        .section-header h1 { font-size: 2.5rem; }
        .card-body { padding: 1.5rem; }
    }
</style>

<div class="blog-list">
    <div class="section-header">
        <h1>Blog</h1>
        <p>Actualités, insights et retours d’expérience en communication institutionnelle</p>
    </div>

    <div class="toolbar">
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Rechercher un article..." id="searchInput">
            <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
            <div class="search-count" id="resultCount">0</div>
        </div>

        <div class="filter-group">
            <select class="filter-select" id="categoryFilter">
                <option value="">Toutes catégories</option>
                {% for value, label in CATEGORIES %}
                <option value="{{ value }}">{{ label }}</option>
                {% endfor %}
            </select>
            <select class="filter-select" id="sortSelect">
                <option value="recent">Plus récent</option>
                <option value="ancien">Plus ancien</option>
                <option value="alpha">Titre (A-Z)</option>
            </select>
        </div>

        <div class="view-buttons">
            <button class="view-btn active" data-grid="1" title="1 colonne">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
            </button>
            <button class="view-btn" data-grid="3" title="3 colonnes">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="8" height="8" rx="1"/>
                    <rect x="13" y="3" width="8" height="8" rx="1"/>
                    <rect x="3" y="13" width="8" height="8" rx="1"/>
                    <rect x="13" y="13" width="8" height="8" rx="1"/>
                </svg>
            </button>
            <button class="view-btn" data-grid="6" title="6 colonnes">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="5" height="5" rx="1"/>
                    <rect x="10" y="3" width="5" height="5" rx="1"/>
                    <rect x="17" y="3" width="5" height="5" rx="1"/>
                    <rect x="3" y="10" width="5" height="5" rx="1"/>
                    <rect x="10" y="10" width="5" height="5" rx="1"/>
                    <rect x="17" y="10" width="5" height="5" rx="1"/>
                    <rect x="3" y="17" width="5" height="5" rx="1"/>
                    <rect x="10" y="17" width="5" height="5" rx="1"/>
                    <rect x="17" y="17" width="5" height="5" rx="1"/>
                </svg>
            </button>
        </div>
    </div>

    <div id="blogContainer"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const sortSelect = document.getElementById('sortSelect');
    const viewBtns = document.querySelectorAll('.view-btn');
    const resultCount = document.getElementById('resultCount');
    const container = document.getElementById('blogContainer');

    function updateGrid() {
        const activeBtn = document.querySelector('.view-btn.active');
        const grid = container.querySelector('#blogGrid');
        if (grid && activeBtn) {
            grid.className = `blog-grid grid-${activeBtn.dataset.grid}`;
        }
    }

    function fetchBlogs() {
        const params = new URLSearchParams({
            search: searchInput.value.trim(),
            category: categoryFilter.value,
            sort: sortSelect.value,
            page: 1
        });

        fetch(`{% url 'blogs:blogs_list_ajax' %}?${params}`)
            .then(r => r.json())
            .then(data => {
                container.innerHTML = data.html;
                resultCount.textContent = data.count;
                resultCount.classList.toggle('show', data.count > 0);
                updateGrid();
            });
    }

    searchInput.addEventListener('input', () => setTimeout(fetchBlogs, 400));
    categoryFilter.addEventListener('change', fetchBlogs);
    sortSelect.addEventListener('change', fetchBlogs);

    container.addEventListener('click', e => {
        const btn = e.target.closest('.pagination-btn[data-page]');
        if (btn) {
            const page = btn.dataset.page;
            const params = new URLSearchParams(window.location.search);
            params.set('page', page);
            fetch(`{% url 'blogs:blogs_list_ajax' %}?${params}`)
                .then(r => r.json())
                .then(data => {
                    container.innerHTML = data.html;
                    history.replaceState(null, '', `?${params}`);
                    updateGrid();
                });
        }
    });

    viewBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            viewBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateGrid();
        });
    });

    fetchBlogs();
});
</script>
{% endblock %}